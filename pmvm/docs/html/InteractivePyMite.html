<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.6: http://docutils.sourceforge.net/" />
<title>Interactive PyMite</title>
<meta name="author" content="Dean Hall" />
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 5951 2009-05-18 18:03:10Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left{
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: left }

/* div.align-center * { */
/*   text-align: left } */

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block {
  margin-left: 2em ;
  margin-right: 2em }

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document" id="interactive-pymite">
<h1 class="title">Interactive PyMite</h1>
<table class="docinfo" frame="void" rules="none">
<col class="docinfo-name" />
<col class="docinfo-content" />
<tbody valign="top">
<tr><th class="docinfo-name">Author:</th>
<td>Dean Hall</td></tr>
<tr class="field"><th class="docinfo-name">Id:</th><td class="field-body">InteractivePyMite.txt 450 2010-03-11 21:29:42Z dwhall256</td>
</tr>
</tbody>
</table>
<!-- Copyright 2006 Dean Hall
Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.2
or any later version published by the Free Software Foundation;
with no Invariant Sections, no Front-Cover Texts, and no Back-Cover
Texts.  A copy of the license is in the file docs/LICENSE. -->
<div class="section" id="purpose">
<h1>Purpose</h1>
<p>This document describes the design, implementation and use of the interactive
session for PyMite.  In doing so, it serves as a design document for the PyMite
developer and a user manual for the PyMite user.</p>
</div>
<div class="section" id="overview">
<h1>Overview</h1>
<p>Interactive PyMite (ipm) is a core feature of PyMite that allows the user to
type lines of source code on a host computer that is to be executed on a target
device.  Ipm provides rapid code experimentation much like <a class="reference external" href="http://docs.python.org/tutorial/interpreter.html#interactive-mode">Python's
interactive mode</a>.  Ipm is made from two pieces: the interactive
interface running on the host (ipm-host) and a program running on the target
that communicates with the host and executes the interactive code (ipm-target).</p>
</div>
<div class="section" id="design-of-ipm-host">
<h1>Design of ipm-host</h1>
<p>Ipm-host is the program that runs on a host computer (desktop or laptop)
and runs on 3 popular operating systems (Mac OS X, Linux and MS-Win32).
Ipm-host provides an interactive interface much like CPython's interactive
mode.  The user provides the desired method to connect to the target as
an option given to ipm-host.  Ipm-host connects to the target over the
designated connection method and communicates bi-directionally with the target.</p>
<p>Ipm-host prints a prompt and accept user input.  Three types of input are
accepted: source code to be executed on the target, commands that change
the operating environment, and commands to interrupt or quit the interactive
session.</p>
<p>When the user types source code, the code is compiled to a code image
using pmImgCreator.py found in src/tools.  The image is sent over the
connection to the target device.  Ipm-host reads all reply characters
from the connection until a designated termination byte is received.  Ipm-host
prints the reply to the host's screen and repeats the process.</p>
<p>Ipm-host commands are TBD.  One early estimate of a command is
<tt class="docutils literal">load &lt;module&gt;</tt>.  Which compiles a module on the host to an image and
transfers the image to the target where it is stored in persistent memory.
Ipm-host commands should not use names that are Python keywords and ipm
users shall not be able to name variables that are names of ipm commands.</p>
<p>Ipm-host accepts two special control commands: Ctrl+C and Ctrl+D.
Ctrl+C interrupts ipm-host as it waits for a reply from the target
and causes ipm-host to ignore any response from the target.
Ctrl+D causes ipm-host to signal ipm-target to quit; and then ipm-host itself
quits.</p>
</div>
<div class="section" id="design-of-ipm-target">
<h1>Design of ipm-target</h1>
<p>Ipm-target is a program that runs in the PyMite VM on the target device
(embedded or desktop).  Ipm-target is implemented in the <tt class="docutils literal">ipm</tt> module that
is part of PyMite's standard library.  The target device must be explicitly
programmed to initiate the ipm-target program.</p>
<p>Ipm-target waits indefinitely for input over the target's standard connection
(serial port).  Ipm-target expects a code image.  Ipm-target converts the code
image to a code object and then calls the built-in function <tt class="docutils literal">eval()</tt> on that
code object.  Since the code image was compiled by ipm-host using the <tt class="docutils literal">single</tt>
argument to <tt class="docutils literal">compile()</tt>, the code image already contains the commands
necessary to print output.  After the code is executed ipm-target
sends the designated terminal byte to indicate that evaluation is
complete and that ipm-target is ready for the next image.</p>
</div>
<div class="section" id="using-ipm-host">
<h1>Using ipm-host</h1>
<p>PyMite includes the Python program, <tt class="docutils literal">src/tools/ipm.py</tt>, that is a
cross-platform implementation of ipm-host that runs from a command prompt.</p>
<p><tt class="docutils literal">src/tools/ipm.py</tt> requires the <a class="reference external" href="http://pyserial.sourceforge.net/">pySerial package</a> that can be installed
like this:</p>
<pre class="literal-block">
easy_install pyserial
</pre>
</div>
<div class="section" id="running-ipm-on-the-desktop">
<h1>Running ipm on the Desktop</h1>
<p>The sample project in <tt class="docutils literal">src/platform/desktop/</tt> was created to build PyMite
for the desktop target. The output of this project is used by ipm-host when it
is commanded to connect using the &quot;desktop&quot; connection.  Perform the following
steps from the project root directory to build and run ipm on the desktop:</p>
<pre class="literal-block">
make ipm
</pre>
<p>Ipm-host should launch and print its startup message followed by the ipm prompt.
Now you may type source code and see the results.  Type Ctrl+D (twice) when
you are done.  The following is a sample interactive session:</p>
<pre class="literal-block">
ipm&gt; print &quot;timmy&quot;
timmy
ipm&gt; d={}
ipm&gt; d[0] = None
ipm&gt; d[1] = &quot;one&quot;
ipm&gt; d[2] = abs(-99)
ipm&gt; d[3] = len(range(5))
ipm&gt; d['hello'] = &quot;world&quot;
ipm&gt; t = (2,&quot;tuple&quot;)
ipm&gt; d[t] = []
ipm&gt; print d
{(2, 'tuple'):[], 'hello':'world', 3:5, 2:99, 1:'one', 0:None}
ipm&gt; [chr(x+0x30) for x in range(50) if x%4 == 3]
['3', '7', ';', '?', 'C', 'G', 'K', 'O', 'S', 'W', '[', '_']
ipm&gt; ^D
</pre>
<p>To manually start ipm-host, first cd to <tt class="docutils literal">src/tools</tt>.
To run both ipm-host and ipm-target on the desktop:</p>
<pre class="literal-block">
$ ./ipm -d
</pre>
<p>Or to connect to a target device runing ipm via a serial port:</p>
<pre class="literal-block">
$ ./ipm -s &lt;port&gt; &lt;baud&gt;
</pre>
<p>or, more verbosely:</p>
<pre class="literal-block">
$ ./ipm --serial=&lt;port&gt; --baud=&lt;baud&gt;
</pre>
<p>where <em>&lt;port&gt;</em> is <tt class="docutils literal">comX</tt> (and X is a number of the com port) on a Cygwin host
or the serial device filename on a Mac or Linux host (e.g. <tt class="docutils literal">/dev/cu.usbmodem1912</tt>);
and <em>&lt;baud&gt;</em> should correspond to the target's configured baud rate for the
serial port you are connecting to, 19200 by default.</p>
</div>
<div class="section" id="running-ipm-on-an-embedded-target">
<h1>Running ipm on an embedded target</h1>
<p>The sample project in <tt class="docutils literal">src/platform/mmb103</tt> demonstrates running ipm on an
Atmel ATmega103 microcontroller and connecting to its UART.  This project is
specific to hardware that is not publicly availble; so it cannot be used as is.
However, it serves as an example that can be copied.</p>
<p>To run ipm on the target, write your PyMite application so that it executes
these two lines.  The second line runs in a loop until an exception occurs that
causes the VM to exit:</p>
<pre class="literal-block">
import ipm
ipm.ipm()
</pre>
<!-- :mode=rest: -->
</div>
</div>
</body>
</html>
