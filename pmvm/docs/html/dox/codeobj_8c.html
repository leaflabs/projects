<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Python-on-a-chip: src/vm/codeobj.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.9 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_ff1f71d793b0515fd7dbd2b1cc3fec2f.html">src</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_caedc41f685a85e6101892ad4c886813.html">vm</a>
  </div>
</div>
<div class="contents">
<h1>codeobj.c File Reference</h1>CodeObj Type.  
<a href="#_details">More...</a>
<p>
<code>#include &quot;<a class="el" href="pm_8h_source.html">pm.h</a>&quot;</code><br>

<p>
<a href="codeobj_8c_source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="3a6bfa4879119353796792d81967ec0a"></a><!-- doxytag: member="codeobj.c::__FILE_ID__" ref="3a6bfa4879119353796792d81967ec0a" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>__FILE_ID__</b>&nbsp;&nbsp;&nbsp;0x01</td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="pm_8h.html#78d16e71b533f23ea2eaa9453f966d56">PmReturn_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="codeobj_8c.html#a6f6a2e6b173994a159fd4b1d87baea5">co_loadFromImg</a> (<a class="el" href="mem_8h.html#9c68f72c120fc5a782d464c144aafa2b">PmMemSpace_t</a> memspace, <a class="el" href="pic24_2include_2stdint_8h.html#ba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> const **paddr, <a class="el" href="struct_pm_obj__s.html">pPmObj_t</a> *r_pco)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="codeobj_8c.html#5e8607ce10fa100f91ff11717300787c">co_rSetCodeImgAddr</a> (<a class="el" href="struct_pm_co__s.html">pPmCo_t</a> pco, <a class="el" href="pic24_2include_2stdint_8h.html#ba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> const *pimg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="pm_8h.html#78d16e71b533f23ea2eaa9453f966d56">PmReturn_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="codeobj_8c.html#c1fdd3b08e931b8412cb73f1e391a52a">no_loadFromImg</a> (<a class="el" href="mem_8h.html#9c68f72c120fc5a782d464c144aafa2b">PmMemSpace_t</a> memspace, <a class="el" href="pic24_2include_2stdint_8h.html#ba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> const **paddr, <a class="el" href="struct_pm_obj__s.html">pPmObj_t</a> *r_pno)</td></tr>

</table>
<hr><h2>Detailed Description</h2>
CodeObj Type. 
<p>
CodeObj type operations. 
<p>Definition in file <a class="el" href="codeobj_8c_source.html">codeobj.c</a>.</p>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a6f6a2e6b173994a159fd4b1d87baea5"></a><!-- doxytag: member="codeobj.c::co_loadFromImg" ref="a6f6a2e6b173994a159fd4b1d87baea5" args="(PmMemSpace_t memspace, uint8_t const **paddr, pPmObj_t *r_pco)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pm_8h.html#78d16e71b533f23ea2eaa9453f966d56">PmReturn_t</a> co_loadFromImg           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="mem_8h.html#9c68f72c120fc5a782d464c144aafa2b">PmMemSpace_t</a>&nbsp;</td>
          <td class="paramname"> <em>memspace</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="pic24_2include_2stdint_8h.html#ba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> const **&nbsp;</td>
          <td class="paramname"> <em>paddr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_pm_obj__s.html">pPmObj_t</a> *&nbsp;</td>
          <td class="paramname"> <em>r_pco</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Creates a CodeObj by loading info from a code image in memory.<p>
An image is a static representation of a Python object. The process of converting an object to and from an image is also called marshalling. In PyMite, code images are the equivalent of .pyc files. Code images can only contain a select subset of object types (None, Int, Float, String, Slice?, Tuple, and CodeImg). All other types (Lists, Dicts, CodeObjs, Modules, Classes, Functions, ClassInstances) are built at runtime.<p>
All multibyte values are in Little Endian order (least significant byte comes first in the byte stream).<p>
memspace and *paddr determine the start of the code image. Load the code object with values from the code image, including the names and consts tuples. Leave contents of paddr pointing one byte past end of code img.<p>
The code image has the following structure: -type: 8b - OBJ_TYPE_CIM -size: 16b - number of bytes the code image occupies. -argcount: 8b - number of arguments to this code obj. -stacksz: 8b - the maximum arg-stack size needed. -nlocals: 8b - number of local vars in the code obj. -names: Tuple - tuple of <a class="el" href="namespacestring.html" title="Provides PyMite&#39;s string module.">string</a> objs. -consts: Tuple - tuple of objs. -code: 8b[] - bytecode array.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>memspace</em>&nbsp;</td><td>memory space containing image </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>paddr</em>&nbsp;</td><td>ptr to ptr to code img in memspace return by reference: paddr points one byte past end of code img </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>r_pco</em>&nbsp;</td><td>Return arg. New code object with fields filled in. </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>Return status </dd></dl>

<p>Definition at line <a class="el" href="codeobj_8c_source.html#l00033">33</a> of file <a class="el" href="codeobj_8c_source.html">codeobj.c</a>.</p>

</div>
</div><p>
<a class="anchor" name="5e8607ce10fa100f91ff11717300787c"></a><!-- doxytag: member="codeobj.c::co_rSetCodeImgAddr" ref="5e8607ce10fa100f91ff11717300787c" args="(pPmCo_t pco, uint8_t const *pimg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void co_rSetCodeImgAddr           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_pm_co__s.html">pPmCo_t</a>&nbsp;</td>
          <td class="paramname"> <em>pco</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="pic24_2include_2stdint_8h.html#ba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> const *&nbsp;</td>
          <td class="paramname"> <em>pimg</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Recursively sets image address of the CO and all its nested COs in its constant pool. This is done so that an image that was received during an interactive session will persist as long as any of its COs/funcs/objects is still alive.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>pco</em>&nbsp;</td><td>Pointer to root code object whose images are set </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>pimg</em>&nbsp;</td><td>Pointer to very top of code image (PmodeImgObj) </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="codeobj_8c_source.html#l00142">142</a> of file <a class="el" href="codeobj_8c_source.html">codeobj.c</a>.</p>

</div>
</div><p>
<a class="anchor" name="c1fdd3b08e931b8412cb73f1e391a52a"></a><!-- doxytag: member="codeobj.c::no_loadFromImg" ref="c1fdd3b08e931b8412cb73f1e391a52a" args="(PmMemSpace_t memspace, uint8_t const **paddr, pPmObj_t *r_pno)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pm_8h.html#78d16e71b533f23ea2eaa9453f966d56">PmReturn_t</a> no_loadFromImg           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="mem_8h.html#9c68f72c120fc5a782d464c144aafa2b">PmMemSpace_t</a>&nbsp;</td>
          <td class="paramname"> <em>memspace</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="pic24_2include_2stdint_8h.html#ba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> const **&nbsp;</td>
          <td class="paramname"> <em>paddr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_pm_obj__s.html">pPmObj_t</a> *&nbsp;</td>
          <td class="paramname"> <em>r_pno</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Creates a Native code object by loading a native image.<p>
An image is a static representation of a Python object. A native image is much smaller than a regular image because only two items of data are needed after the type: the number of args the <a class="el" href="namespacefunc.html" title="Provides PyMite&#39;s func module.">func</a> expects and the index into the native function table. A reference to the image is not needed since it is just as efficient to store the info in RAM as it is to store a pointer and memspace value.<p>
memspace and *paddr determine the start of the native image. Loads the argcount and the <a class="el" href="namespacefunc.html" title="Provides PyMite&#39;s func module.">func</a> index from the native object. Leaves contents of paddr pointing one byte past end of code img.<p>
The native image has the following structure: -type: 8b - OBJ_TYPE_CIM -argcount: 8b - number of arguments to this code obj. -code: 16b - index into native function table.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>memspace</em>&nbsp;</td><td>memory space containing image </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>paddr</em>&nbsp;</td><td>ptr to ptr to code img in memspace (return) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>r_pno</em>&nbsp;</td><td>Return by reference, new code object </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>Return status </dd></dl>

<p>Definition at line <a class="el" href="codeobj_8c_source.html#l00162">162</a> of file <a class="el" href="codeobj_8c_source.html">codeobj.c</a>.</p>

</div>
</div><p>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Oct 18 07:40:49 2010 for Python-on-a-chip by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.9 </small></address>
</body>
</html>
