<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.6: http://docutils.sourceforge.net/" />
<title>PyMite VM Errors and Exceptions</title>
<meta name="author" content="Dean Hall" />
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 5951 2009-05-18 18:03:10Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left{
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: left }

/* div.align-center * { */
/*   text-align: left } */

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block {
  margin-left: 2em ;
  margin-right: 2em }

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document" id="pymite-vm-errors-and-exceptions">
<h1 class="title">PyMite VM Errors and Exceptions</h1>
<table class="docinfo" frame="void" rules="none">
<col class="docinfo-name" />
<col class="docinfo-content" />
<tbody valign="top">
<tr><th class="docinfo-name">Author:</th>
<td>Dean Hall</td></tr>
<tr class="field"><th class="docinfo-name">Id:</th><td class="field-body">ErrorsAndExceptions.txt 317 2009-03-17 02:25:27Z dwhall</td>
</tr>
</tbody>
</table>
<!-- Copyright 2006 Dean Hall
Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.2
or any later version published by the Free Software Foundation;
with no Invariant Sections, no Front-Cover Texts, and no Back-Cover
Texts.  A copy of the license is in the file docs/LICENSE. -->
<div class="section" id="purpose">
<h1>Purpose</h1>
<p>This document describes the types of errors and exceptions that
can occur with the PyMite virtual machine (VM).
In doing so, it serves primarily as a design document for the PyMite
developer and, to a lesser extent, a user manual for the PyMite user.</p>
</div>
<div class="section" id="overview">
<h1>Overview</h1>
<p>PyMite shall define the C data type <tt class="docutils literal">PmReturn_t</tt> as the general type for
error codes that are returned from functions within the VM.  Since some
functions need to return an exception and do not have access to the VM's
stack, <tt class="docutils literal">PmReturn_t</tt> is also capable of returning codes that indicate
when an exceptional situation has occured.  PyMite supports only a subset
of the exception types that <a class="reference external" href="http://docs.python.org/api/standardExceptions.html">Python has</a>.</p>
<p>When a function returns a code to the VM that indicates an exceptional
situation, the VM quits the normal interpreter loop and raises an exception.
If the application program has prepared to catch the exception, the VM will
do so; otherwise, an unhandled exception causes the interpreter loop to quit
and the <tt class="docutils literal">PmReturn_t</tt> code is returned to the calling environment.</p>
</div>
<div class="section" id="errors">
<h1>Errors</h1>
<p>The <tt class="docutils literal">PmReturn_t</tt> data type is defined in <tt class="docutils literal">src/vm/pm.h</tt>.
It is an enumeration that needs to fit within eight bits,
which means there are only 256 values available for use.</p>
<p>Currently there are only a few values that are allocated for function return
status values.  The following table lists these values and their meanings:</p>
<blockquote>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="14%" />
<col width="61%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Name</th>
<th class="head">Value</th>
<th class="head">Meaning</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>PM_RET_OK</td>
<td>0x00</td>
<td>Everything is okay</td>
</tr>
<tr><td>PM_RET_NO</td>
<td>0xFF</td>
<td>General &quot;no result&quot;</td>
</tr>
<tr><td>PM_RET_ERR</td>
<td>0xFE</td>
<td>General failure</td>
</tr>
<tr><td>PM_RET_STUB</td>
<td>0xFD</td>
<td>Return value for stub function</td>
</tr>
</tbody>
</table>
</blockquote>
</div>
<div class="section" id="exceptions">
<h1>Exceptions</h1>
<p>The other values of the <tt class="docutils literal">PmReturn_t</tt> enumeration are used to indicate an
exceptional situation that will cause the VM to quit unless it is properly
handled.  The list of exceptions implemented is determined partly by necessity
and partly by an estimation of future necessity.  The following table lists
the return types that will lead to exceptions:</p>
<blockquote>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="14%" />
<col width="61%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Name</th>
<th class="head">Value</th>
<th class="head">Meaning</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>PM_RET_EX</td>
<td>0xE0</td>
<td>General exception</td>
</tr>
<tr><td>PM_RET_EX_EXIT</td>
<td>0xE1</td>
<td>System exit</td>
</tr>
<tr><td>PM_RET_EX_IO</td>
<td>0xE2</td>
<td>Input/output error</td>
</tr>
<tr><td>PM_RET_EX_ZDIV</td>
<td>0xE3</td>
<td>Zero division error</td>
</tr>
<tr><td>PM_RET_EX_ASSRT</td>
<td>0xE4</td>
<td>Assertion error</td>
</tr>
<tr><td>PM_RET_EX_ATTR</td>
<td>0xE5</td>
<td>Attribute error</td>
</tr>
<tr><td>PM_RET_EX_IMPRT</td>
<td>0xE6</td>
<td>Import error</td>
</tr>
<tr><td>PM_RET_EX_INDX</td>
<td>0xE7</td>
<td>Index error</td>
</tr>
<tr><td>PM_RET_EX_KEY</td>
<td>0xE8</td>
<td>Key error</td>
</tr>
<tr><td>PM_RET_EX_MEM</td>
<td>0xE9</td>
<td>Memory error</td>
</tr>
<tr><td>PM_RET_EX_NAME</td>
<td>0xEA</td>
<td>Name error</td>
</tr>
<tr><td>PM_RET_EX_RUNTIME</td>
<td>0xEB</td>
<td>Runtime error</td>
</tr>
<tr><td>PM_RET_EX_SYNTAX</td>
<td>0xEB</td>
<td>Syntax error</td>
</tr>
<tr><td>PM_RET_EX_SYS</td>
<td>0xEc</td>
<td>System error</td>
</tr>
<tr><td>PM_RET_EX_TYPE</td>
<td>0xED</td>
<td>Type error</td>
</tr>
<tr><td>PM_RET_EX_VAL</td>
<td>0xEE</td>
<td>Value error</td>
</tr>
<tr><td>PM_RET_EX_STOP</td>
<td>0xEF</td>
<td>Stop iteration</td>
</tr>
<tr><td>PM_RET_EX_WARN</td>
<td>0xF0</td>
<td>Warning</td>
</tr>
</tbody>
</table>
</blockquote>
<p>In PyMite, there is only one kind of exception object and the PyMite user
should not try to subclass it.  Instead, the user should create an instance
of Exception and set the <tt class="docutils literal">code</tt> attribute to a value that is unique among
all other exceptions.  For built-in exception types, the <tt class="docutils literal">code</tt> field has
a value that is identical to the <tt class="docutils literal">PmReturn_t</tt> value with the same meaning.</p>
<p>For example the built-in <tt class="docutils literal">AssertionError</tt> is created like this in the
builtins module:</p>
<pre class="literal-block">
AssertionError = _exn()
AssertionError.code = 0xE4
</pre>
<p>User exceptions are usually written in Python application code, but can be
created in a PyMite native function.  The following is an example of how to
create a user exception:</p>
<pre class="literal-block">
SerialError = _exn()
SerialError.code = 0xC0
</pre>
<p>That's all there is to it.  Just be sure that the <tt class="docutils literal">code</tt> is completely unique
from all other kinds of exceptions, both system and user exceptions.</p>
<!-- :mode=rest: -->
</div>
</div>
</body>
</html>
